---
title: 'An near-optimal tour of Aachen'
date: 2024-11-28
permalink: /posts/2024/11/aachen-fountains/
tags:
  - interests
  - aachen
---
<html lang="en">
<head>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

<!--         <script>
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        </script>
     -->
    <style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>

    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <link rel="stylesheet" href="https://d3-annotation.susielu.com/assets/d3.annotation.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"/>
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"/> -->
    <!-- <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css"/> -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <script src="https://cdn.jsdelivr.net/gh/elfalem/Leaflet.curve/src/leaflet.curve.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
    
             <style>
                #map_4345da8416a360146c06209c41abb8ae {
                    position: absolute; /* Ensures no spacing within the container */
                    top: 0;
                    left: 0;
                    bottom: 0;
                    right: 0;
                    width: 100%;
                    height: 100%;
                }
                .leaflet-container { font-size: 1rem; }
                .map-container {
                    position: absolute; /* Fix the position to eliminate gaps */
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    width: 100%;
                    height: 100%;
                    margin: 0; /* Remove any extra spacing */
                    border: none; /* Optional: Remove border if unnecessary */
                }
            .map-controls {
                  position: absolute;
                  top: 10px;
                  right: 10px;
                  z-index: 9999;
                  background-color: white;
                  padding: 10px;
                  border-radius: 5px;
                  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Adds a subtle shadow */
              }
              .map-controls select {
                  display: inline-block;
                  width: auto;
                  max-width: 200px;
              }

            </style>
</head>
<body>

    <header>
        <h1>Aachen’s Fountains: A Nerdy Quest to Solve a Summer Promise</h1>
    </header>
    <section>
        <p>
            When I lived in Aachen—a city brimming with history, charm, and yes, fountains—my friend Aadu Huli and I made an ambitious summer plan: visit every fountain in town. A quintessential “once summer” goal. But summer after summer, we let that plan evaporate like mist on a hot day. Now, years later, I’m finally solving this puzzle. Not just solving it—I’m turning it into a computational adventure.
        </p>
    </section>
    <section>
        <h2>The Quest: A Tour of Aachen’s Fountains</h2>
        <p>
            Aachen is famous for its fountains, each telling its own story. From the playful Puppenbrunnen to the iconic Elisenbrunnen, these waterworks are scattered throughout the city. They’re not just decorative but an integral part of the city’s identity. So, when I decided to “finally do this,” I thought, why not make it fun and nerdy? Why not solve the <em>Traveling Salesman Problem</em> (TSP) to plan the route?
        </p>
    </section>
    <section>
        <h2>What is the Traveling Salesman Problem (TSP)?</h2>
        <p>
            For the uninitiated, the TSP is a classic optimization problem where a "salesman" must visit \( N \) cities (or fountains, in our case), minimizing the total distance traveled and returning to the starting point. Formally, given a set of locations \( \{1, 2, \dots, N\} \) with distances \( d(i, j) \) between them, the goal is to minimize:
        </p>
        <p>
            <code>Total Distance = Σ d(i, i+1)</code>
        </p>
        <p>
            The catch? TSP is NP-complete. For larger \( N \), finding the exact solution is computationally infeasible. Instead, we settle for approximate solutions using heuristics like <em>simulated annealing</em>.
        </p>
    </section>
    <section>
        <h2>Data Collection: A Wiki-Fountain Treasure Trove</h2>
        <p>
            The fountains list came from <a href="https://commons.wikimedia.org/wiki/Fountains_in_Aachen" target="_blank">Wiki Commons</a>, where each fountain has its coordinates, name, and sometimes a photo. After some cleaning (and nudging overlapping fountains by &lt;10m to make them unique), I fed the data into my code.
        </p>
    </section>
    <section>
        <h2>Computing the Optimal Routes</h2>
        <h3>Case 1: As the Crow Flies</h3>
        <p>
            Using the Haversine formula:
        </p>
        <pre>
d(i, j) = 2r * arcsin(sqrt(sin²((φj - φi)/2) + cos(φi)cos(φj)sin²((λj - λi)/2)))
        </pre>
        <p>
            This gives the “straight-line” distance between fountains.
        </p>
        <h3>Case 2: Walking Paths</h3>
        <p>
            I used the <a href="https://openrouteservice.org/" target="_blank">OpenRouteService API</a> to compute the actual walking distances. The API returned a detailed distance matrix, making the solution more realistic for those of us without wings.
        </p>
        <p>
            Both distance matrices were fed into a simulated annealing algorithm (thanks, Frigidum!). The algorithm mimics the cooling process of metals, finding a near-optimal route by progressively "cooling" the search space.
        </p>
    </section>
    <section>
        <h2>The Visualization</h2>
        <ul>
            <li><strong>A dropdown menu:</strong> Switch between the "crow flies" and "walking" routes.</li>
            <li><strong>Hover-over markers:</strong> Each fountain displays its name and an image from Wiki Commons.</li>
            <li><strong>Measured distances:</strong> Easily compare the efficiency of both routes.</li>
        </ul>
        <p>
            For nerds like me, it’s also fun to note that the starting fountain is chosen based on proximity to the geographic mean of all points—a little mathematical cherry on top.
        </p>
    </section>
    <section>
        <h2>What Makes This Awesome?</h2>
        <ul>
            <li><strong>It’s practical:</strong> The total distance (~20 km) is a leisurely outing, perfect for a summer day.</li>
            <li><strong>It’s customizable:</strong> Want to include elevation? Mixed transport modes? Just tweak the distance matrix!</li>
            <li><strong>It’s shareable:</strong> Download the KML file (link below) and import it into Google MyMaps for your own adventure.</li>
        </ul>
    </section>
    <section>
        <h2>The Bigger Picture: Why TSP is Cool</h2>
        <p>
            Solving TSP for fountains might seem trivial, but this problem has real-world applications:
        </p>
        <ul>
            <li><strong>Logistics:</strong> Delivery routes for Amazon or UPS.</li>
            <li><strong>Genetics:</strong> Sequencing DNA.</li>
            <li><strong>Manufacturing:</strong> Circuit board design.</li>
        </ul>
        <p>Sometimes, though, it’s just about keeping a summer promise.</p>
    </section>
    <section>
        <h2>What’s Next?</h2>
        <p>
            After solving this computationally, it’s time for the fun part: visiting Aachen again and walking the optimized route. Aadu Huli, if you’re reading this, pack your walking shoes. We’ve got a date with some fountains.
        </p>
    </section>
    <section>
        <h2>Ready to Solve It Yourself?</h2>
        <ul>
            <li><strong>Code:</strong> Available on GitHub.</li>
            <li><strong>API Access:</strong> Create an account on OpenRouteService.</li>
            <li><strong>Fountain Data:</strong> Use my provided CSV file.</li>
            <li><strong>Map Import:</strong> Download the KML file <a href="#">here</a>.</li>
        </ul>
    </section>
    <section>
        <h2>Meme Time</h2>
        <ul>
            <li><strong>TSP Math Nerds:</strong> “Me: Solves NP-complete problems for fun. Also me: Forgets to pack snacks.”</li>
            <li><strong>Simulated Annealing:</strong> “Chill your problems, bro. Literally.”</li>
        </ul>
        <p>
            Stay computational, stay curious, and don’t forget to hydrate—especially when chasing fountains.
        </p>
    </section>

<div style="border: 1px solid #ccc; margin: 20px 0; position:relative; width:100%; height:600px;">


 <script>

d3.json("/assets/data/route_cache.json", function (error, data) {
    if (error) {
        console.error("Error loading JSON file:", error);
        return;
    }

    const paths = data;

     window.updateMap = function(routeType) {
        clearMap();

        if (paths && paths[routeType]) {
            var route = paths[routeType].path;
            var distance = paths[routeType].distance.toFixed(2); 
            var latlngs = [];

            document.getElementById("distanceLabel").innerText = "Total Distance: " + distance + " km";

            if (routeType === "crow_flies") {
                for (var i = 0; i < route.length; i++) {
                    var point = route[i];
                    latlngs.push([point.lat, point.lon]);

                    var markerColor, tooltipLabel;
                    if (i === 0) {
                        markerColor = 'red';
                        tooltipLabel = `Start: ${point.name}`;
                    } else if (i === route.length - 1) {
                        markerColor = 'blue';
                        tooltipLabel = `End: ${point.name}`;
                    } else {
                        markerColor = 'green';
                        tooltipLabel = `Point ${i + 1}: ${point.name}`;
                    }

                    var tooltipContent = `
                        <div style="text-align: center;">
                            <strong>${tooltipLabel}</strong><br>
                            <img src="${point.image_url}" alt="${point.name}" style="width:150px; height:150px; object-fit: cover; margin-top:5px;">
                        </div>
                    `;

                    L.circleMarker([point.lat, point.lon], {
                        radius: 6,
                        color: markerColor,
                        fillColor: markerColor,
                        fillOpacity: 0.8,
                        title: point.name
                    }).addTo(map_4345da8416a360146c06209c41abb8ae)
                    .bindTooltip(tooltipContent, { permanent: false, direction: "top", className: "custom-tooltip" });
                }
            } else if (routeType === "walking_distance") {
                for (var i = 0; i < route.length; i++) {
                    latlngs.push([route[i].lat, route[i].lon]);
                }
                for (var i = 0; i < paths["walking_distance"].order.length; i++) {
                    var point = paths["walking_distance"].order[i];

                    var markerColor, tooltipLabel;
                    if (i === 0) {
                        markerColor = 'red';
                        tooltipLabel = `Start: ${point.name}`;
                    } else if (i === paths["walking_distance"].order.length - 1) {
                        markerColor = 'blue';
                        tooltipLabel = `End: ${point.name}`;
                    } else {
                        markerColor = 'green';
                        tooltipLabel = `Point ${i + 1}: ${point.name}`;
                    }

                    var tooltipContent = `
                        <div style="text-align: center;">
                            <strong>${tooltipLabel}</strong><br>
                            <img src="${point.image_url}" alt="${point.name}" style="width:150px; height:150px; object-fit: cover; margin-top:5px;">
                        </div>
                    `;

                    L.circleMarker([point.lat, point.lon], {
                        radius: 6,
                        color: markerColor,
                        fillColor: markerColor,
                        fillOpacity: 0.8,
                        title: point.name
                    }).addTo(map_4345da8416a360146c06209c41abb8ae)
                    .bindTooltip(tooltipContent, { permanent: false, direction: "top", className: "custom-tooltip" });
                }
            }

            L.polyline(latlngs, {
                color: routeType === 'crow_flies' ? 'red' : 'green',
                weight: 3,
                opacity: 0.7
            }).addTo(map_4345da8416a360146c06209c41abb8ae);
        }
    };

    function clearMap() {
        map_4345da8416a360146c06209c41abb8ae.eachLayer(function (layer) {
            if (layer !== tile_layer_c6662b5f0e163d2b2d40ea34941395bc) {
                map_4345da8416a360146c06209c41abb8ae.removeLayer(layer);
            }
        });
    }

    document.addEventListener("DOMContentLoaded", function () {
        updateMap("crow_flies");
    });
});



    
</script>


   <div class="map-container">

        <div class="map-controls" style="position: absolute; top: 10px; right: 10px; z-index: 9999; background-color: white; padding: 10px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);">
        <label for="routeType">Select Route Type:</label>
        <select id="routeType" onchange="updateMap(this.value)">
            <option value="crow_flies">As the Crow Flies</option>
            <option value="walking_distance">Walking Distance</option>
        </select>
        <br>
        <label id="distanceLabel" style="margin-top: 5px; display: block;">Total Distance: 0.00 km</label>
    </div>
    
    <style>
        .custom-tooltip {
            background: white;
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 5px;
            text-align: center;
        }
        .custom-tooltip img {
            display: block;
            margin: 0 auto;
            width: 200px;
            height: 200px;
            object-fit: cover;
        }
    </style>

            <div class="folium-map" id="map_4345da8416a360146c06209c41abb8ae" ></div>

    </div>
</body>

<script>
    
    
            var map_4345da8416a360146c06209c41abb8ae = L.map(
                "map_4345da8416a360146c06209c41abb8ae",
                {
                    center: [50.776351, 6.083862],
                    crs: L.CRS.EPSG3857,
                    zoom: 13,
                    zoomControl: true,
                    preferCanvas: false,
                }
            );

            

        
    
            var tile_layer_c6662b5f0e163d2b2d40ea34941395bc = L.tileLayer(
                "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
                {"attribution": "\u0026copy; \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors", "detectRetina": false, "maxNativeZoom": 19, "maxZoom": 19, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
            );
        
    
            tile_layer_c6662b5f0e163d2b2d40ea34941395bc.addTo(map_4345da8416a360146c06209c41abb8ae);

</script>
</html>
